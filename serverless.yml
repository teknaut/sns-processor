service: s3-sns-processor
frameworkVersion: '4'

provider:
  name: aws
  runtime: provided.al2023
  architecture: x86_64
  region: ${opt:region, 'eu-west-1'}
  stage: ${opt:stage, 'dev'}
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - s3:GetObject
            - s3:GetObjectAttributes
          Resource: arn:aws:s3:::${self:service}-${sls:stage}-uploads/*

package:
  artifact: target/function.zip

functions:
  s3EventProcessor:
    handler: com.example.handler.S3EventHandler
    description: Processes S3 object events directly
    memorySize: 256
    timeout: 30
    environment:
      STAGE: ${sls:stage}
    events:
      - s3:
          bucket: ${self:service}-${sls:stage}-uploads
          event: s3:ObjectCreated:*

resources:
  Outputs:
    UploadsBucketName:
      Value: ${self:service}-${sls:stage}-uploads
      Export:
        Name: ${self:service}-${sls:stage}-uploads-bucket
